<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dependency-buster // Analysis Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        /* ══════════════════════════════════════════════════════════════════
           DESIGN SYSTEM: Bauhaus + Dieter Rams + Teenage Engineering
           "Less, but better" — Functional, honest, geometric, playful
           Pure vanilla CSS - no preprocessors
           ══════════════════════════════════════════════════════════════════ */
        
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            /* Teenage Engineering Orange + Bauhaus Primary */
            --te-orange: #FF6B00;
            --te-orange-dim: rgba(255, 107, 0, 0.15);
            --bauhaus-red: #E63946;
            --bauhaus-blue: #457B9D;
            --bauhaus-yellow: #F4A261;
            
            /* Dieter Rams Neutrals */
            --bg-primary: #0A0A0A;
            --bg-secondary: #141414;
            --bg-tertiary: #1A1A1A;
            --bg-card: #111111;
            --border: #2A2A2A;
            --border-subtle: #1F1F1F;
            
            /* Typography - WCAG AA Compliant */
            --text-primary: #FAFAFA;
            --text-secondary: #A0A0A0;  /* Improved: 7:1 contrast ratio */
            --text-tertiary: #777777;   /* Improved: 4.5:1 contrast ratio */
            
            /* Semantic */
            --success: #10B981;
            --warning: #F59E0B;
            --error: #EF4444;
            --info: #3B82F6;
            
            /* Spacing (8px grid) */
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 24px;
            --space-6: 32px;
            --space-7: 48px;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            font-size: 14px;
            -webkit-font-smoothing: antialiased;
        }
        
        /* Layout */
        .app { display: grid; grid-template-columns: 260px 1fr; min-height: 100vh; }
        
        .sidebar {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: var(--space-5);
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
        }
        
        .main { padding: var(--space-6); overflow-x: hidden; }
        
        /* Logo */
        .logo { display: flex; align-items: center; gap: var(--space-3); margin-bottom: var(--space-6); }
        .logo-mark {
            width: 32px; height: 32px;
            background: var(--te-orange);
            display: flex; align-items: center; justify-content: center;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700; font-size: 12px;
            color: var(--bg-primary);
        }
        .logo-text {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500; font-size: 13px;
        }
        .logo-text span { color: var(--text-tertiary); }
        
        /* Navigation */
        .nav-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px; font-weight: 600;
            letter-spacing: 0.1em; text-transform: uppercase;
            color: var(--text-tertiary);
            margin: var(--space-5) 0 var(--space-3) 0;
        }
        
        .nav-item {
            display: flex; align-items: center; gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            margin: 0 calc(-1 * var(--space-4));
            cursor: pointer;
            transition: all 0.15s ease;
            border-left: 2px solid transparent;
            font-size: 13px;
            color: var(--text-secondary);
        }
        .nav-item:hover { background: var(--bg-tertiary); color: var(--text-primary); }
        .nav-item.active {
            background: var(--te-orange-dim);
            border-left-color: var(--te-orange);
            color: var(--te-orange);
        }
        .nav-indicator {
            width: 6px; height: 6px;
            background: var(--success);
            margin-left: auto;
        }
        
        /* Stats Mini */
        .stats-mini {
            background: var(--bg-tertiary);
            padding: var(--space-4);
            margin-top: var(--space-6);
        }
        .stats-mini-row {
            display: flex; justify-content: space-between;
            padding: var(--space-2) 0;
            border-bottom: 1px solid var(--border-subtle);
            font-size: 12px;
        }
        .stats-mini-row:last-child { border-bottom: none; }
        .stats-mini-value {
            font-family: 'JetBrains Mono', monospace;
            color: var(--te-orange);
        }
        
        /* Header */
        .header {
            display: flex; justify-content: space-between; align-items: flex-start;
            margin-bottom: var(--space-6);
            padding-bottom: var(--space-5);
            border-bottom: 1px solid var(--border);
        }
        .header-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px; font-weight: 600;
        }
        .header-subtitle { font-size: 13px; color: var(--text-secondary); margin-top: var(--space-2); }
        .header-timestamp {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px; color: var(--text-tertiary);
        }
        
        .impl-badges { display: flex; gap: var(--space-2); margin-top: var(--space-3); }
        .impl-badge {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            padding: var(--space-1) var(--space-3);
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
        }
        .impl-badge.ts { border-color: var(--bauhaus-blue); color: var(--bauhaus-blue); }
        .impl-badge.go { border-color: var(--success); color: var(--success); }
        .impl-badge.rust { border-color: var(--te-orange); color: var(--te-orange); }
        
        /* Sections */
        .section { margin-bottom: var(--space-7); }
        .section-header {
            display: flex; align-items: center; gap: var(--space-3);
            margin-bottom: var(--space-5);
        }
        .section-number {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px; color: var(--te-orange);
            background: var(--te-orange-dim);
            padding: var(--space-1) var(--space-2);
        }
        .section-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px; font-weight: 600;
            letter-spacing: 0.05em; text-transform: uppercase;
        }
        
        /* Grid */
        .grid { display: grid; gap: var(--space-4); }
        .grid-4 { grid-template-columns: repeat(4, 1fr); }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-2 { grid-template-columns: repeat(2, 1fr); }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: var(--space-5);
        }
        .card-header {
            display: flex; justify-content: space-between; align-items: flex-start;
            margin-bottom: var(--space-4);
        }
        .card-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px; color: var(--text-tertiary);
            text-transform: uppercase; letter-spacing: 0.05em;
        }
        .card-badge {
            font-family: 'JetBrains Mono', monospace;
            font-size: 9px; padding: 2px 6px;
            background: var(--te-orange-dim); color: var(--te-orange);
        }
        .card-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 32px; font-weight: 300;
            line-height: 1;
        }
        .card-unit { font-size: 14px; color: var(--text-secondary); margin-left: var(--space-1); }
        .card-meta { font-size: 11px; color: var(--text-tertiary); margin-top: var(--space-3); }
        
        /* Table */
        .table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .table th {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.05em;
            color: var(--text-tertiary); text-align: left;
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--border);
        }
        .table td {
            padding: var(--space-4);
            border-bottom: 1px solid var(--border-subtle);
            font-family: 'JetBrains Mono', monospace;
        }
        .table tr:hover td { background: var(--bg-tertiary); }
        .table .metric-name { font-family: 'Inter', sans-serif; color: var(--text-secondary); }
        .table .best { color: var(--te-orange); position: relative; }
        .table .best::before {
            content: ''; position: absolute; left: 0; top: 50%;
            transform: translateY(-50%);
            width: 3px; height: 60%; background: var(--te-orange);
        }
        
        /* Chart */
        .chart-container { height: 200px; position: relative; }
        .chart-container-lg { height: 300px; }
        
        /* Smoke Test Button */
        .smoke-test-btn {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            background: var(--bg-tertiary);
            border: 1px solid var(--te-orange);
            color: var(--te-orange);
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .smoke-test-btn:hover {
            background: var(--te-orange);
            color: var(--bg-primary);
        }
        .smoke-test-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .smoke-test-btn.running {
            background: var(--te-orange-dim);
            border-color: var(--te-orange);
            color: var(--te-orange);
            animation: pulse 1.5s infinite;
        }
        .smoke-test-btn.success {
            border-color: var(--success);
            color: var(--success);
        }
        .smoke-test-btn.error {
            border-color: var(--error);
            color: var(--error);
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        .btn-icon { font-size: 10px; }
        
        /* Test Results Modal */
        .test-modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
        }
        .test-modal.visible {
            opacity: 1;
            visibility: visible;
        }
        .test-modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            padding: var(--space-5);
        }
        .test-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-4);
            border-bottom: 1px solid var(--border);
        }
        .test-modal-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            font-weight: 600;
        }
        .test-modal-close {
            background: none;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            font-size: 18px;
            padding: var(--space-2);
        }
        .test-modal-close:hover { color: var(--text-primary); }
        .test-result-item {
            padding: var(--space-3);
            border: 1px solid var(--border);
            margin-bottom: var(--space-3);
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
        }
        .test-result-item.pass { border-left: 3px solid var(--success); }
        .test-result-item.fail { border-left: 3px solid var(--error); }
        .test-result-item.pending { border-left: 3px solid var(--warning); }
        .test-result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-2);
        }
        .test-result-name { font-weight: 500; }
        .test-result-status { 
            font-size: 10px;
            padding: 2px 6px;
            text-transform: uppercase;
        }
        .test-result-status.pass { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .test-result-status.fail { background: rgba(239, 68, 68, 0.2); color: var(--error); }
        .test-result-status.pending { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .test-result-details {
            color: var(--text-secondary);
            font-size: 11px;
        }
        .test-progress-bar {
            height: 4px;
            background: var(--bg-tertiary);
            margin-top: var(--space-2);
            overflow: hidden;
        }
        .test-progress-fill {
            height: 100%;
            background: var(--te-orange);
            width: 0%;
            transition: width 0.3s ease;
        }
        .test-progress-fill.complete { background: var(--success); }
        .test-progress-fill.failed { background: var(--error); }
        .test-metrics {
            display: flex;
            gap: var(--space-4);
            margin-top: var(--space-2);
            font-size: 10px;
            color: var(--text-secondary);
        }
        .test-metric {
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }
        .test-metric-value {
            font-family: 'JetBrains Mono', monospace;
            color: var(--te-orange);
        }
        .test-summary {
            background: var(--bg-tertiary);
            padding: var(--space-4);
            margin-top: var(--space-4);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .test-summary-stats {
            display: flex;
            gap: var(--space-5);
        }
        .test-summary-stat {
            text-align: center;
        }
        .test-summary-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            font-weight: 300;
        }
        .test-summary-value.pass { color: var(--success); }
        .test-summary-value.fail { color: var(--error); }
        .test-summary-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }
        .overall-progress {
            margin-bottom: var(--space-5);
        }
        .overall-progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--space-2);
            font-size: 11px;
        }
        .overall-progress-bar {
            height: 6px;
            background: var(--bg-tertiary);
            overflow: hidden;
        }
        .overall-progress-fill {
            height: 100%;
            background: var(--te-orange);
            width: 0%;
            transition: width 0.2s ease;
        }
        
        /* Test History */
        .test-history {
            margin-top: var(--space-5);
            border-top: 1px solid var(--border);
            padding-top: var(--space-4);
        }
        .test-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-3);
        }
        .test-history-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--te-orange);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .test-history-clear {
            font-size: 10px;
            color: var(--text-secondary);
            background: none;
            border: 1px solid var(--border);
            padding: 2px 8px;
            cursor: pointer;
        }
        .test-history-clear:hover {
            border-color: var(--error);
            color: var(--error);
        }
        .test-history-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }
        .test-history-stat {
            background: var(--bg-tertiary);
            padding: var(--space-3);
            text-align: center;
        }
        .test-history-stat-label {
            font-size: 10px;
            color: var(--text-secondary);
            margin-bottom: var(--space-1);
        }
        .test-history-stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 16px;
            font-weight: 500;
        }
        .test-history-stat-value.best { color: var(--success); }
        .test-history-stat-value.worst { color: var(--error); }
        .test-history-stat-value.avg { color: var(--te-orange); }
        .test-history-runs {
            max-height: 150px;
            overflow-y: auto;
        }
        .test-history-run {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-2) var(--space-3);
            border-bottom: 1px solid var(--border-subtle);
            font-size: 11px;
        }
        .test-history-run:last-child { border-bottom: none; }
        .test-history-run-time {
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-secondary);
        }
        .test-history-run-result {
            display: flex;
            gap: var(--space-3);
        }
        .test-history-run-pass { color: var(--success); }
        .test-history-run-fail { color: var(--error); }
        .test-history-run-duration {
            font-family: 'JetBrains Mono', monospace;
            color: var(--te-orange);
        }
        .stability-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-top: var(--space-3);
            padding: var(--space-3);
            background: var(--bg-tertiary);
            font-size: 11px;
        }
        .stability-bar {
            flex: 1;
            height: 4px;
            background: var(--border);
            position: relative;
        }
        .stability-fill {
            height: 100%;
            transition: width 0.3s ease;
        }
        .stability-fill.excellent { background: var(--success); }
        .stability-fill.good { background: var(--te-orange); }
        .stability-fill.poor { background: var(--error); }
        
        /* Tabs - HTMX powered */
        .tabs { display: flex; gap: 0; border-bottom: 1px solid var(--border); margin-bottom: var(--space-5); }
        .tab {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            padding: var(--space-3) var(--space-5);
            background: none; border: none;
            color: var(--text-tertiary);
            cursor: pointer; position: relative;
        }
        .tab:hover { color: var(--text-secondary); }
        .tab.active { color: var(--te-orange); }
        .tab.active::after {
            content: ''; position: absolute;
            bottom: -1px; left: 0; right: 0;
            height: 2px; background: var(--te-orange);
        }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }
        
        /* Tree */
        .tree-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            height: 400px; position: relative; overflow: hidden;
        }
        /* Language badges for detected languages */
        .lang-badge {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            padding: var(--space-1) var(--space-3);
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }
        .lang-badge.php { border-color: #8892BF; color: #8892BF; }
        .lang-badge.javascript { border-color: #F7DF1E; color: #F7DF1E; }
        .lang-badge.typescript { border-color: #3178C6; color: #3178C6; }
        .lang-badge.python { border-color: #3776AB; color: #3776AB; }
        .lang-badge.go { border-color: #00ADD8; color: #00ADD8; }
        .lang-badge.rust { border-color: #DEA584; color: #DEA584; }
        .lang-badge.java { border-color: #ED8B00; color: #ED8B00; }
        .lang-badge.ruby { border-color: #CC342D; color: #CC342D; }
        .lang-badge.csharp { border-color: #239120; color: #239120; }
        
        /* Package List */
        .package-list {
            max-height: 350px; overflow-y: auto;
            background: var(--bg-card);
            border: 1px solid var(--border);
        }
        .package-item {
            display: grid;
            grid-template-columns: 1fr 100px 80px;
            gap: var(--space-4);
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--border-subtle);
            font-size: 12px;
        }
        .package-item:hover { background: var(--bg-tertiary); }
        .package-name { font-family: 'JetBrains Mono', monospace; }
        .package-version { font-family: 'JetBrains Mono', monospace; color: var(--success); text-align: right; }
        .package-license { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--text-tertiary); text-align: right; }
        
        /* Severity */
        .severity-item {
            display: flex; align-items: center; gap: var(--space-3);
            padding: var(--space-3) 0;
            border-bottom: 1px solid var(--border-subtle);
        }
        .severity-dot { width: 8px; height: 8px; }
        .severity-dot.critical { background: var(--error); }
        .severity-dot.high { background: var(--te-orange); }
        .severity-dot.medium { background: var(--warning); }
        .severity-dot.low { background: var(--bauhaus-blue); }
        .severity-dot.safe { background: var(--success); }
        .severity-label { flex: 1; font-size: 12px; }
        .severity-count { font-family: 'JetBrains Mono', monospace; font-size: 14px; font-weight: 600; }
        
        /* License Matrix */
        .license-matrix { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: var(--space-3); }
        .license-cell {
            background: var(--bg-card); border: 1px solid var(--border);
            padding: var(--space-4); text-align: center;
        }
        .license-cell.safe { border-left: 3px solid var(--success); }
        .license-cell.review { border-left: 3px solid var(--warning); }
        .license-name { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--text-secondary); }
        .license-count { font-family: 'JetBrains Mono', monospace; font-size: 20px; font-weight: 300; margin-top: var(--space-2); }
        
        /* Namespace Tags */
        .namespace-cloud { display: flex; flex-wrap: wrap; gap: var(--space-2); }
        .namespace-tag {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            padding: var(--space-2) var(--space-3);
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }
        .namespace-tag:hover { border-color: var(--te-orange); color: var(--te-orange); }
        
        /* Raw Output */
        .output-select {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            padding: var(--space-2) var(--space-3);
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-primary);
        }
        .output-content {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: var(--space-4);
            max-height: 350px; overflow: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px; line-height: 1.6;
            white-space: pre-wrap;
            color: var(--text-secondary);
        }
        
        /* HTMX Loading Indicator */
        .htmx-indicator { opacity: 0; transition: opacity 0.2s ease; }
        .htmx-request .htmx-indicator { opacity: 1; }
        .htmx-request.htmx-indicator { opacity: 1; }
        
        /* Empty State */
        .empty { color: var(--text-tertiary); font-style: italic; padding: var(--space-5); text-align: center; }
        
        /* Capabilities Grid */
        .cap-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: var(--space-3); }
        .cap-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: var(--space-4);
            display: flex; flex-direction: column; gap: var(--space-2);
        }
        .cap-item.enabled { border-left: 3px solid var(--success); }
        .cap-item.partial { border-left: 3px solid var(--warning); }
        .cap-item.disabled { border-left: 3px solid var(--text-tertiary); }
        .cap-name {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px; font-weight: 600;
        }
        .cap-status {
            font-size: 10px;
            display: flex; align-items: center; gap: var(--space-2);
        }
        .cap-status .dot { width: 6px; height: 6px; border-radius: 50%; }
        .cap-status .dot.on { background: var(--success); }
        .cap-status .dot.partial { background: var(--warning); }
        .cap-status .dot.off { background: var(--text-tertiary); }
        .cap-desc { font-size: 10px; color: var(--text-tertiary); }
        
        /* Namespace Grid */
        .ns-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: var(--space-3); max-height: 400px; overflow-y: auto; }
        .ns-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: var(--space-3);
        }
        .ns-name {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px; font-weight: 500;
            color: var(--te-orange);
            margin-bottom: var(--space-2);
        }
        .ns-meta { font-size: 10px; color: var(--text-tertiary); display: flex; gap: var(--space-4); }
        .ns-classes { font-size: 10px; color: var(--text-secondary); margin-top: var(--space-2); }
        
        /* Responsive */
        @media (max-width: 1200px) { .grid-4 { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 900px) {
            .app { grid-template-columns: 1fr; }
            .sidebar { display: none; }
            .grid-3 { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 600px) { .grid-4, .grid-3, .grid-2 { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-mark">DPB</div>
                <div class="logo-text">dep-buster<span>// v1.0</span></div>
            </div>
            
            <nav>
                <div class="nav-label">Analysis</div>
                <a class="nav-item active" href="#performance" hx-push-url="true">
                    Performance
                    <div class="nav-indicator"></div>
                </a>
                <a class="nav-item" href="#dependencies" hx-push-url="true">
                    Dependencies
                    <div class="nav-indicator"></div>
                </a>
                <a class="nav-item" href="#security" hx-push-url="true">
                    Security
                    <div class="nav-indicator" style="background: var(--warning)"></div>
                </a>
                <a class="nav-item" href="#licenses" hx-push-url="true">
                    Licenses
                    <div class="nav-indicator"></div>
                </a>
                <a class="nav-item" href="#namespaces" hx-push-url="true">
                    Namespaces
                    <div class="nav-indicator"></div>
                </a>
                
                <div class="nav-label">Server</div>
                <a class="nav-item" href="#capabilities" hx-push-url="true">
                    Capabilities
                    <div class="nav-indicator"></div>
                </a>
                
                <div class="nav-label">Output</div>
                <a class="nav-item" href="#raw" hx-push-url="true">Raw Data</a>
                
                <div class="nav-label">Documentation</div>
                <a class="nav-item" href="#" onclick="Dashboard.openDocumentation(); return false;">
                    View Documentation
                    <div class="nav-indicator" style="background: var(--success)"></div>
                </a>
                <a class="nav-item" href="#" onclick="Dashboard.showDocsModal(); return false;">
                    View Docs Guide
                    <div class="nav-indicator" style="background: var(--info)"></div>
                </a>
            </nav>
            
            <div class="stats-mini">
                <div class="nav-label">Quick Stats</div>
                <div class="stats-mini-row">
                    <span>Packages</span>
                    <span class="stats-mini-value" id="stat-packages">--</span>
                </div>
                <div class="stats-mini-row">
                    <span>Namespaces</span>
                    <span class="stats-mini-value" id="stat-namespaces">--</span>
                </div>
                <div class="stats-mini-row">
                    <span>Fastest</span>
                    <span class="stats-mini-value" id="stat-fastest">--</span>
                </div>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main">
            <header class="header">
                <div>
                    <h1 class="header-title">Analysis Dashboard</h1>
                    <p class="header-subtitle" id="project-info">Loading project info...</p>
                </div>
                <div style="text-align: right; display: flex; flex-direction: column; align-items: flex-end; gap: var(--space-3);">
                    <button class="smoke-test-btn" id="run-smoke-test" onclick="Dashboard.runSmokeTests()">
                        <span class="btn-icon">▶</span>
                        <span class="btn-text">Run Smoke Tests</span>
                    </button>
                    <div class="header-timestamp" id="timestamp">--</div>
                    <div class="impl-badges" id="detected-langs">
                        <!-- Dynamically populated with detected languages -->
                    </div>
                </div>
            </header>
            
            <!-- 01 Performance -->
            <section class="section" id="performance">
                <div class="section-header">
                    <span class="section-number">01</span>
                    <span class="section-title">Performance Metrics</span>
                </div>
                
                <div class="grid grid-4" id="winners-grid">
                    <!-- Populated by JS -->
                </div>
                
                <div class="grid grid-2" style="margin-top: var(--space-4);">
                    <div class="card">
                        <div class="card-label" style="margin-bottom: var(--space-4);">Detailed Comparison</div>
                        <table class="table">
                            <thead>
                                <tr><th>Metric</th><th>TypeScript</th><th>Go</th><th>Rust</th></tr>
                            </thead>
                            <tbody id="comparison-table"></tbody>
                        </table>
                    </div>
                    <div class="card">
                        <div class="card-label" style="margin-bottom: var(--space-4);">Tool Execution Times</div>
                        <div class="chart-container-lg"><canvas id="chart-tools"></canvas></div>
                    </div>
                </div>
                
                <div class="card" style="margin-top: var(--space-4);">
                    <div class="card-label" style="margin-bottom: var(--space-4);">Documentation Generation Benchmarks</div>
                    <div id="docs-benchmark-section">
                        <table class="table" style="margin-top: var(--space-3);">
                            <thead>
                                <tr><th>Implementation</th><th>Time</th><th>Status</th></tr>
                            </thead>
                            <tbody id="docs-benchmark-table">
                                <tr><td colspan="3" style="text-align: center; color: var(--text-secondary); padding: var(--space-4);">Run benchmarks to see documentation generation performance</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- 02 Dependencies -->
            <section class="section" id="dependencies">
                <div class="section-header">
                    <span class="section-number">02</span>
                    <span class="section-title">Dependency Analysis</span>
                </div>
                
                <div class="grid grid-3" id="dep-stats"></div>
                
                <div class="card" style="margin-top: var(--space-4);">
                    <div class="card-header">
                        <span class="card-label">Dependency Tree</span>
                    </div>
                    <div class="tree-container" id="tree-container"></div>
                </div>
                
                <div class="grid grid-2" style="margin-top: var(--space-4);">
                    <div class="card">
                        <div class="card-label" style="margin-bottom: var(--space-4);">Dependency Types</div>
                        <div class="chart-container"><canvas id="chart-deps"></canvas></div>
                    </div>
                    <div>
                        <div class="card-label" style="margin-bottom: var(--space-3);">Package List</div>
                        <!-- HTMX Tabs -->
                        <div class="tabs" role="tablist">
                            <button class="tab active" onclick="Dashboard.showTab(this, 'pkg-ts')">TypeScript</button>
                            <button class="tab" onclick="Dashboard.showTab(this, 'pkg-go')">Go</button>
                            <button class="tab" onclick="Dashboard.showTab(this, 'pkg-rust')">Rust</button>
                        </div>
                        <div id="pkg-ts" class="tab-panel active"><div class="package-list" id="list-pkg-ts"></div></div>
                        <div id="pkg-go" class="tab-panel"><div class="package-list" id="list-pkg-go"></div></div>
                        <div id="pkg-rust" class="tab-panel"><div class="package-list" id="list-pkg-rust"></div></div>
                    </div>
                </div>
            </section>
            
            <!-- 03 Security -->
            <section class="section" id="security">
                <div class="section-header">
                    <span class="section-number">03</span>
                    <span class="section-title">Security Audit</span>
                </div>
                
                <div class="grid grid-2">
                    <div class="card">
                        <div class="card-label" style="margin-bottom: var(--space-4);">Severity Breakdown</div>
                        <div id="severity-list"></div>
                    </div>
                    <div class="card">
                        <div class="card-label" style="margin-bottom: var(--space-4);">Vulnerability Details</div>
                        <div id="vuln-list"></div>
                    </div>
                </div>
            </section>
            
            <!-- 04 Licenses -->
            <section class="section" id="licenses">
                <div class="section-header">
                    <span class="section-number">04</span>
                    <span class="section-title">License Analysis</span>
                </div>
                
                <div class="grid grid-3" id="license-stats"></div>
                
                <div class="card" style="margin-top: var(--space-4);">
                    <div class="card-label" style="margin-bottom: var(--space-4);">License Distribution</div>
                    <div class="license-matrix" id="license-matrix"></div>
                </div>
            </section>
            
            <!-- 05 Namespaces -->
            <section class="section" id="namespaces">
                <div class="section-header">
                    <span class="section-number">05</span>
                    <span class="section-title">Namespace Detection</span>
                </div>
                
                <div class="grid grid-3" id="ns-stats"></div>
                
                <div class="card" style="margin-top: var(--space-4);">
                    <div class="card-label" style="margin-bottom: var(--space-4);">Namespace Map</div>
                    <div class="ns-grid" id="ns-grid"></div>
                </div>
            </section>
            
            <!-- 06 Server Capabilities -->
            <section class="section" id="capabilities">
                <div class="section-header">
                    <span class="section-number">06</span>
                    <span class="section-title">Server Capabilities</span>
                </div>
                
                <div class="grid grid-3">
                    <div class="card">
                        <div class="card-label" style="margin-bottom: var(--space-3);">TypeScript</div>
                        <div class="cap-grid" id="cap-ts"></div>
                    </div>
                    <div class="card">
                        <div class="card-label" style="margin-bottom: var(--space-3);">Go</div>
                        <div class="cap-grid" id="cap-go"></div>
                    </div>
                    <div class="card">
                        <div class="card-label" style="margin-bottom: var(--space-3);">Rust</div>
                        <div class="cap-grid" id="cap-rust"></div>
                    </div>
                </div>
                
                <div class="card" style="margin-top: var(--space-4);">
                    <div class="card-label" style="margin-bottom: var(--space-4);">Enterprise Features Matrix</div>
                    <table class="table">
                        <thead>
                            <tr><th>Feature</th><th>TypeScript</th><th>Go</th><th>Rust</th><th>Description</th></tr>
                        </thead>
                        <tbody id="feature-matrix"></tbody>
                    </table>
                </div>
            </section>
            
            <!-- 07 Raw Output -->
            <section class="section" id="raw">
                <div class="section-header">
                    <span class="section-number">07</span>
                    <span class="section-title">Raw Output</span>
                </div>
                
                <div class="tabs" role="tablist">
                    <button class="tab active" onclick="Dashboard.showTab(this, 'raw-ts')">TypeScript</button>
                    <button class="tab" onclick="Dashboard.showTab(this, 'raw-go')">Go</button>
                    <button class="tab" onclick="Dashboard.showTab(this, 'raw-rust')">Rust</button>
                </div>
                
                <div id="raw-ts" class="tab-panel active">
                    <div style="margin-bottom: var(--space-3);">
                        <select class="output-select" onchange="Dashboard.showOutput('ts', this.value)">
                            <option value="analyze_dependencies">analyze_dependencies</option>
                            <option value="analyze_psr4">analyze_psr4</option>
                            <option value="detect_namespaces">detect_namespaces</option>
                            <option value="audit_security">audit_security</option>
                            <option value="analyze_licenses">analyze_licenses</option>
                        </select>
                    </div>
                    <pre class="output-content" id="output-ts">Loading...</pre>
                </div>
                <div id="raw-go" class="tab-panel">
                    <div style="margin-bottom: var(--space-3);">
                        <select class="output-select" onchange="Dashboard.showOutput('go', this.value)">
                            <option value="analyze_dependencies">analyze_dependencies</option>
                            <option value="analyze_psr4">analyze_psr4</option>
                            <option value="detect_namespaces">detect_namespaces</option>
                            <option value="audit_security">audit_security</option>
                            <option value="analyze_licenses">analyze_licenses</option>
                        </select>
                    </div>
                    <pre class="output-content" id="output-go">Loading...</pre>
                </div>
                <div id="raw-rust" class="tab-panel">
                    <div style="margin-bottom: var(--space-3);">
                        <select class="output-select" onchange="Dashboard.showOutput('rust', this.value)">
                            <option value="analyze_dependencies">analyze_dependencies</option>
                            <option value="analyze_psr4">analyze_psr4</option>
                            <option value="detect_namespaces">detect_namespaces</option>
                            <option value="audit_security">audit_security</option>
                            <option value="analyze_licenses">analyze_licenses</option>
                        </select>
                    </div>
                    <pre class="output-content" id="output-rust">Loading...</pre>
                </div>
            </section>
        </main>
    </div>
    
    <script>
    // ══════════════════════════════════════════════════════════════════════════
    // DASHBOARD - Pure Vanilla JavaScript + HTMX Integration
    // No Python, No frameworks - just clean JS
    // ══════════════════════════════════════════════════════════════════════════
    
    const Dashboard = (function() {
        'use strict';
        
        // Data placeholders - injected by benchmark script
        const projectInfo = /*PROJECT_INFO*/{"name":"azuracast","path":"/Users/kedsonqueiroz/Documents/GitHub/FaithFM/dpb-mcp-workspace/test-repos/azuracast","languages":[
  "PHP",
  "TypeScript",
  "JavaScript"
],"packageManager":"NPM","totalFiles":1966}/*END_PROJECT_INFO*/;
        const benchmarkResults = /*BENCHMARK_DATA*/{"TypeScript":{"size_mb":.02,"startup_ms":467,"memory_mb":15.08,"analyze_dependencies":461,"analyze_psr4":685,"detect_namespaces":720,"audit_security":515,"analyze_licenses":475,"generate_mkdocs_docs":985},"Go":{"size_mb":6.24,"startup_ms":115,"memory_mb":39.96,"analyze_dependencies":134,"analyze_psr4":140,"detect_namespaces":242,"audit_security":123,"analyze_licenses":135,"generate_mkdocs_docs":339},"Rust":{"size_mb":2.95,"startup_ms":102,"memory_mb":26.80,"analyze_dependencies":113,"analyze_psr4":133,"detect_namespaces":175,"audit_security":112,"analyze_licenses":100,"generate_mkdocs_docs":216}}/*END_BENCHMARK_DATA*/;
        const analysisData = /*ANALYSIS_DATA*/{}/*END_ANALYSIS_DATA*/;
        const timestamp = /*TIMESTAMP*/new Date().toISOString()/*END_TIMESTAMP*/;
        
        const impls = ['TypeScript', 'Go', 'Rust'];
        const colors = { TypeScript: '#457B9D', Go: '#10B981', Rust: '#FF6B00' };
        
        let treeZoom = null;
        
        // ══════════════════════════════════════════════════════════════════
        // UTILITIES
        // ══════════════════════════════════════════════════════════════════
        
        function $(id) { return document.getElementById(id); }
        
        function findWinner(metric) {
            let winner = null, best = Infinity;
            impls.forEach(impl => {
                const val = benchmarkResults[impl]?.[metric] || 0;
                if (val > 0 && val < best) { best = val; winner = impl; }
            });
            return { impl: winner, value: best };
        }
        
        function html(strings, ...values) {
            return strings.reduce((result, str, i) => result + str + (values[i] || ''), '');
        }
        
        // ══════════════════════════════════════════════════════════════════
        // PERFORMANCE
        // ══════════════════════════════════════════════════════════════════
        
        function renderWinners() {
            const metrics = [
                { key: 'startup_ms', label: 'Fastest Startup', unit: 'ms', desc: 'Cold start initialization' },
                { key: 'size_mb', label: 'Smallest Binary', unit: 'MB', desc: 'Compiled binary size' },
                { key: 'total_analysis', label: 'Fastest Analysis', unit: 'ms', desc: 'Total tool execution' },
                { key: 'memory_mb', label: 'Memory Estimate', unit: 'MB', desc: 'Runtime memory usage' }
            ];
            
            // Calculate total analysis time
            const tools = ['analyze_dependencies', 'analyze_psr4', 'detect_namespaces', 'audit_security', 'analyze_licenses'];
            impls.forEach(impl => {
                benchmarkResults[impl] = benchmarkResults[impl] || {};
                benchmarkResults[impl].total_analysis = tools.reduce((sum, t) => sum + (benchmarkResults[impl][t] || 0), 0);
            });
            
            $('winners-grid').innerHTML = metrics.map(m => {
                const w = findWinner(m.key);
                return html`
                    <div class="card">
                        <div class="card-header">
                            <span class="card-label">${m.label}</span>
                            <span class="card-badge">${w.impl || '--'}</span>
                        </div>
                        <div class="card-value">${w.value !== Infinity ? w.value : '--'}<span class="card-unit">${m.unit}</span></div>
                        <div class="card-meta">${m.desc}</div>
                    </div>
                `;
            }).join('');
            
            // Update sidebar stat
            $('stat-fastest').textContent = findWinner('total_analysis').impl || '--';
        }
        
        function renderComparison() {
            const rows = [
                { key: 'startup_ms', label: 'Startup Time', unit: 'ms' },
                { key: 'size_mb', label: 'Binary Size', unit: 'MB' },
                { key: 'memory_mb', label: 'Memory Est.', unit: 'MB' },
                { key: 'analyze_dependencies', label: 'Dependencies', unit: 'ms' },
                { key: 'analyze_psr4', label: 'PSR-4', unit: 'ms' },
                { key: 'detect_namespaces', label: 'Namespaces', unit: 'ms' },
                { key: 'audit_security', label: 'Security', unit: 'ms' },
                { key: 'analyze_licenses', label: 'Licenses', unit: 'ms' },
                { key: 'generate_mkdocs_docs', label: 'Docs Generation', unit: 'ms' }
            ];
            
            $('comparison-table').innerHTML = rows.map(r => {
                const w = findWinner(r.key);
                return html`<tr>
                    <td class="metric-name">${r.label}</td>
                    ${impls.map(impl => {
                        const v = benchmarkResults[impl]?.[r.key] || 0;
                        const isBest = impl === w.impl && v > 0;
                        return html`<td class="${isBest ? 'best' : ''}">${v || '-'} ${v ? r.unit : ''}</td>`;
                    }).join('')}
                </tr>`;
            }).join('');
        }
        
        function renderToolsChart() {
            const tools = ['analyze_dependencies', 'analyze_psr4', 'detect_namespaces', 'audit_security', 'analyze_licenses', 'generate_mkdocs_docs'];
            const labels = ['Deps', 'PSR-4', 'NS', 'Security', 'License', 'Docs'];
            
            new Chart($('chart-tools'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: impls.map(impl => ({
                        label: impl,
                        data: tools.map(t => benchmarkResults[impl]?.[t] || 0),
                        backgroundColor: colors[impl],
                        borderWidth: 0,
                        borderRadius: 2
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'top', labels: { boxWidth: 8, padding: 16 } } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#1F1F1F' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }
        
        function renderDocsBenchmark() {
            const docsBenchmarkTable = document.getElementById('docs-benchmark-table');
            if (!docsBenchmarkTable) return;
            
            const hasData = impls.some(impl => benchmarkResults[impl]?.generate_mkdocs_docs);
            
            if (!hasData) {
                docsBenchmarkTable.innerHTML = `
                    <tr>
                        <td colspan="3" style="text-align: center; color: var(--text-secondary); padding: var(--space-4);">
                            Run benchmarks to see documentation generation performance<br>
                            <small style="font-size: 11px; margin-top: var(--space-2); display: block;">
                                Benchmarks run automatically when server starts for the first time,<br>
                                or use <code>run-benchmark.sh</code> to generate benchmark data
                            </small>
                        </td>
                    </tr>
                `;
                return;
            }
            
            const w = findWinner('generate_mkdocs_docs');
            docsBenchmarkTable.innerHTML = impls.map(impl => {
                const time = benchmarkResults[impl]?.generate_mkdocs_docs || 0;
                const isBest = impl === w.impl && time > 0;
                const status = time > 0 ? '✓ Benchmarked' : 'Not benchmarked';
                
                return html`<tr>
                    <td class="metric-name">${impl}</td>
                    <td class="${isBest ? 'best' : ''}">${time || '-'} ${time ? 'ms' : ''}</td>
                    <td style="color: ${time > 0 ? 'var(--success)' : 'var(--text-secondary)'};">${status}</td>
                </tr>`;
            }).join('');
        }
        
        // ══════════════════════════════════════════════════════════════════
        // DEPENDENCIES
        // ══════════════════════════════════════════════════════════════════
        
        function renderDependencies() {
            const deps = analysisData['TypeScript']?.analyze_dependencies ||
                        analysisData['Go']?.analyze_dependencies ||
                        analysisData['Rust']?.analyze_dependencies || {};
            
            const prodCount = deps.stats?.totalProduction || Object.keys(deps.production || {}).length;
            const devCount = deps.stats?.totalDevelopment || Object.keys(deps.development || {}).length;
            const total = prodCount + devCount;
            
            $('dep-stats').innerHTML = html`
                <div class="card"><div class="card-label">Total Packages</div><div class="card-value">${total || '--'}</div></div>
                <div class="card"><div class="card-label">Production</div><div class="card-value" style="color:var(--success)">${prodCount || '--'}</div></div>
                <div class="card"><div class="card-label">Development</div><div class="card-value" style="color:var(--bauhaus-blue)">${devCount || '--'}</div></div>
            `;
            
            $('stat-packages').textContent = total || '--';
            
            // Doughnut chart
            new Chart($('chart-deps'), {
                type: 'doughnut',
                data: {
                    labels: ['Production', 'Development'],
                    datasets: [{ data: [prodCount, devCount], backgroundColor: ['#10B981', '#457B9D'], borderWidth: 0 }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } }, cutout: '70%' }
            });
            
            // Package lists
            const implIdMap = { TypeScript: 'ts', Go: 'go', Rust: 'rust' };
            impls.forEach(impl => {
                const tree = analysisData[impl]?.analyze_dependencies?.tree || [];
                const el = $(`list-pkg-${implIdMap[impl]}`);
                if (el) {
                    el.innerHTML = tree.length === 0 
                        ? '<div class="empty">No data</div>'
                        : tree.slice(0, 50).map(p => html`
                            <div class="package-item">
                                <span class="package-name">${p.name}</span>
                                <span class="package-version">${p.version}</span>
                                <span class="package-license">${p.license || '-'}</span>
                            </div>
                        `).join('');
                }
            });
            
            // Tree visualization
            renderTree(deps.tree || []);
        }
        
        function renderTree(packages) {
            const container = $('tree-container');
            container.innerHTML = ''; // Clear previous
            
            if (!packages.length) {
                container.innerHTML = '<div class="empty">No dependency tree data</div>';
                return;
            }
            
            const width = container.clientWidth || 900;
            const height = container.clientHeight || 400;
            const margin = { top: 20, right: 120, bottom: 20, left: 80 };
            
            // Build hierarchical structure grouped by vendor
            const root = { name: 'AzuraCast', children: [] };
            const groups = {};
            
            packages.slice(0, 60).forEach(pkg => {
                const vendor = pkg.name.split('/')[0];
                if (!groups[vendor]) {
                    groups[vendor] = { name: vendor, children: [] };
                }
                const pkgName = pkg.name.split('/')[1] || pkg.name;
                groups[vendor].children.push({ 
                    name: pkgName, 
                    version: pkg.version,
                    license: pkg.license 
                });
            });
            
            root.children = Object.values(groups).slice(0, 12);
            
            const svg = d3.select(container)
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            
            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);
            
            // Create horizontal tree layout
            const treeLayout = d3.tree()
                .size([height - margin.top - margin.bottom, width - margin.left - margin.right]);
            
            const hierarchy = d3.hierarchy(root);
            const treeData = treeLayout(hierarchy);
            
            // Add zoom
            treeZoom = d3.zoom()
                .scaleExtent([0.5, 3])
                .on('zoom', e => g.attr('transform', e.transform));
            svg.call(treeZoom);
            
            // Draw links
            g.selectAll('.link')
                .data(treeData.links())
                .join('path')
                .attr('class', 'link')
                .attr('fill', 'none')
                .attr('stroke', '#2A2A2A')
                .attr('stroke-width', 1)
                .attr('d', d3.linkHorizontal()
                    .x(d => d.y)
                    .y(d => d.x));
            
            // Draw nodes
            const node = g.selectAll('.node')
                .data(treeData.descendants())
                .join('g')
                .attr('class', 'node')
                .attr('transform', d => `translate(${d.y},${d.x})`);
            
            node.append('circle')
                .attr('r', d => d.depth === 0 ? 8 : d.children ? 5 : 3)
                .attr('fill', d => d.depth === 0 ? '#FF6B00' : d.children ? '#1A1A1A' : '#333')
                .attr('stroke', '#FF6B00')
                .attr('stroke-width', d => d.depth === 0 ? 2 : 1);
            
            node.append('text')
                .attr('dy', '0.31em')
                .attr('x', d => d.children ? -10 : 10)
                .attr('text-anchor', d => d.children ? 'end' : 'start')
                .text(d => d.data.name)
                .style('font-family', "'JetBrains Mono', monospace")
                .style('font-size', d => d.depth === 0 ? '12px' : d.depth === 1 ? '10px' : '8px')
                .style('fill', d => d.depth === 0 ? '#FF6B00' : d.depth === 1 ? '#FAFAFA' : '#A0A0A0');
        }
        
        // ══════════════════════════════════════════════════════════════════
        // SECURITY
        // ══════════════════════════════════════════════════════════════════
        
        function renderSecurity() {
            const security = analysisData['TypeScript']?.audit_security ||
                            analysisData['Go']?.audit_security ||
                            analysisData['Rust']?.audit_security || {};
            
            const advisories = security.advisories || [];
            const counts = { critical: 0, high: 0, medium: 0, low: 0, safe: security.summary?.safePackages || 0 };
            advisories.forEach(a => counts[(a.severity || 'low').toLowerCase()]++);
            
            $('severity-list').innerHTML = ['critical', 'high', 'medium', 'low', 'safe'].map(s => html`
                <div class="severity-item">
                    <div class="severity-dot ${s}"></div>
                    <span class="severity-label">${s.charAt(0).toUpperCase() + s.slice(1)}</span>
                    <span class="severity-count">${counts[s]}</span>
                </div>
            `).join('');
            
            $('vuln-list').innerHTML = advisories.length === 0
                ? '<div class="empty" style="color: var(--success);">✓ No vulnerabilities detected</div>'
                : advisories.slice(0, 10).map(a => html`
                    <div class="severity-item">
                        <div class="severity-dot ${(a.severity || 'low').toLowerCase()}"></div>
                        <span class="severity-label">${a.package || a.name}</span>
                    </div>
                `).join('');
        }
        
        // ══════════════════════════════════════════════════════════════════
        // LICENSES
        // ══════════════════════════════════════════════════════════════════
        
        function renderLicenses() {
            const lic = analysisData['TypeScript']?.analyze_licenses ||
                       analysisData['Go']?.analyze_licenses ||
                       analysisData['Rust']?.analyze_licenses || {};
            
            const dist = lic.distribution || [];
            const summary = lic.summary || {};
            
            let safe = 0, review = 0;
            dist.forEach(d => d.riskLevel === 'safe' ? safe += d.count : review += d.count);
            
            $('license-stats').innerHTML = html`
                <div class="card"><div class="card-label">Total Licenses</div><div class="card-value">${summary.uniqueLicenses || dist.length || '--'}</div></div>
                <div class="card"><div class="card-label">Safe</div><div class="card-value" style="color:var(--success)">${safe || '--'}</div></div>
                <div class="card"><div class="card-label">Review Required</div><div class="card-value" style="color:var(--warning)">${review || '--'}</div></div>
            `;
            
            $('license-matrix').innerHTML = dist.length === 0
                ? '<div class="empty">No license data</div>'
                : dist.map(d => html`
                    <div class="license-cell ${d.riskLevel || 'safe'}">
                        <div class="license-name">${d.license}</div>
                        <div class="license-count">${d.count}</div>
                    </div>
                `).join('');
        }
        
        // ══════════════════════════════════════════════════════════════════
        // NAMESPACES
        // ══════════════════════════════════════════════════════════════════
        
        function renderNamespaces() {
            const ns = analysisData['TypeScript']?.detect_namespaces ||
                      analysisData['Go']?.detect_namespaces ||
                      analysisData['Rust']?.detect_namespaces || {};
            
            const namespaces = ns.namespaces || [];
            const total = namespaces.length;
            const totalFiles = ns.totalFiles || 0;
            const filesWithoutNs = ns.filesWithoutNamespace || 0;
            
            // Count classes, interfaces, traits
            let classCount = 0, interfaceCount = 0, traitCount = 0;
            namespaces.forEach(n => {
                classCount += (n.classes || []).length;
                interfaceCount += (n.interfaces || []).length;
                traitCount += (n.traits || []).length;
            });
            
            $('ns-stats').innerHTML = html`
                <div class="card"><div class="card-label">Total Namespaces</div><div class="card-value">${total || '--'}</div></div>
                <div class="card"><div class="card-label">Classes</div><div class="card-value" style="color:var(--success)">${classCount || '--'}</div></div>
                <div class="card"><div class="card-label">Interfaces/Traits</div><div class="card-value" style="color:var(--bauhaus-blue)">${interfaceCount + traitCount || '--'}</div></div>
            `;
            
            $('stat-namespaces').textContent = total || '--';
            
            const nsGrid = $('ns-grid');
            if (nsGrid) {
                nsGrid.innerHTML = namespaces.length === 0
                    ? '<div class="empty">No namespace data</div>'
                    : namespaces.slice(0, 30).map(n => html`
                        <div class="ns-item">
                            <div class="ns-name">${n.namespace || 'Unknown'}</div>
                            <div class="ns-meta">
                                <span>📁 ${(n.files || []).length} files</span>
                                <span>📦 ${(n.classes || []).length} classes</span>
                            </div>
                            <div class="ns-classes">${(n.classes || []).slice(0, 5).join(', ')}${(n.classes || []).length > 5 ? '...' : ''}</div>
                        </div>
                    `).join('');
            }
        }
        
        // ══════════════════════════════════════════════════════════════════
        // SERVER CAPABILITIES
        // ══════════════════════════════════════════════════════════════════
        
        function renderCapabilities() {
            const features = [
                { id: 'errors', name: 'Typed Errors', ts: true, go: true, rust: true, desc: 'NotFoundError, ValidationError, AuthenticationError, etc.' },
                { id: 'annotations', name: 'Tool Annotations', ts: true, go: true, rust: true, desc: 'readOnlyHint, idempotentHint, destructiveHint, cacheTtlSeconds' },
                { id: 'http', name: 'HTTP/SSE Transport', ts: true, go: true, rust: true, desc: 'JSON-RPC over HTTP with Server-Sent Events' },
                { id: 'auth', name: 'Authentication', ts: true, go: true, rust: true, desc: 'Static token via MCP_TOKEN environment variable' },
                { id: 'context', name: 'Credentials Context', ts: true, go: true, rust: true, desc: 'RequestContext with credentials, requestId, timestamp' },
                { id: 'registry', name: 'Dynamic Registry', ts: true, go: true, rust: true, desc: 'Runtime action registration with validation' },
            ];
            
            // Render per-implementation capabilities
            ['ts', 'go', 'rust'].forEach(impl => {
                const el = $(`cap-${impl}`);
                if (!el) return;
                
                const implKey = impl === 'ts' ? 'ts' : impl;
                el.innerHTML = features.map(f => {
                    const status = impl === 'ts' ? f.ts : impl === 'go' ? f.go : f.rust;
                    const statusClass = status === true ? 'enabled' : status === 'partial' ? 'partial' : 'disabled';
                    const dotClass = status === true ? 'on' : status === 'partial' ? 'partial' : 'off';
                    const statusText = status === true ? 'Enabled' : status === 'partial' ? 'Partial' : 'N/A';
                    
                    return html`
                        <div class="cap-item ${statusClass}">
                            <div class="cap-name">${f.name}</div>
                            <div class="cap-status">
                                <span class="dot ${dotClass}"></span>
                                <span>${statusText}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            });
            
            // Render feature matrix table
            const matrix = $('feature-matrix');
            if (matrix) {
                matrix.innerHTML = features.map(f => {
                    const tsStatus = f.ts === true ? '✓' : f.ts === 'partial' ? '⚠' : '—';
                    const goStatus = f.go === true ? '✓' : f.go === 'partial' ? '⚠' : '—';
                    const rustStatus = f.rust === true ? '✓' : f.rust === 'partial' ? '⚠' : '—';
                    const tsClass = f.ts === true ? 'best' : '';
                    const goClass = f.go === true ? 'best' : '';
                    const rustClass = f.rust === true ? 'best' : '';
                    
                    return html`
                        <tr>
                            <td class="metric-name">${f.name}</td>
                            <td class="${tsClass}" style="color: ${f.ts === true ? 'var(--success)' : f.ts === 'partial' ? 'var(--warning)' : 'var(--text-tertiary)'}">${tsStatus}</td>
                            <td class="${goClass}" style="color: ${f.go === true ? 'var(--success)' : f.go === 'partial' ? 'var(--warning)' : 'var(--text-tertiary)'}">${goStatus}</td>
                            <td class="${rustClass}" style="color: ${f.rust === true ? 'var(--success)' : f.rust === 'partial' ? 'var(--warning)' : 'var(--text-tertiary)'}">${rustStatus}</td>
                            <td style="color: var(--text-secondary); font-size: 11px;">${f.desc}</td>
                        </tr>
                    `;
                }).join('');
            }
        }
        
        // ══════════════════════════════════════════════════════════════════
        // RAW OUTPUT
        // ══════════════════════════════════════════════════════════════════
        
        function showOutput(impl, tool) {
            const implMap = { ts: 'TypeScript', go: 'Go', rust: 'Rust' };
            const data = analysisData[implMap[impl]]?.[tool];
            const el = $(`output-${impl}`);
            if (el) {
                el.textContent = data ? JSON.stringify(data, null, 2) : 'No data available';
            }
        }
        
        // ══════════════════════════════════════════════════════════════════
        // TAB HANDLING
        // ══════════════════════════════════════════════════════════════════
        
        function showTab(btn, panelId) {
            const container = btn.closest('.section') || document;
            container.querySelectorAll('.tabs .tab').forEach(t => t.classList.remove('active'));
            container.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            btn.classList.add('active');
            $(panelId).classList.add('active');
        }
        
        // ══════════════════════════════════════════════════════════════════
        // TREE ZOOM CONTROLS
        // ══════════════════════════════════════════════════════════════════
        
        function zoomTree(scale) {
            const svg = d3.select('#tree-container svg');
            if (treeZoom) treeZoom.scaleBy(svg.transition().duration(200), scale);
        }
        
        function resetTree() {
            const svg = d3.select('#tree-container svg');
            const container = $('tree-container');
            if (treeZoom) svg.transition().duration(200).call(
                treeZoom.transform,
                d3.zoomIdentity.translate(container.clientWidth/2, container.clientHeight/2)
            );
        }
        
        // ══════════════════════════════════════════════════════════════════
        // INIT
        // ══════════════════════════════════════════════════════════════════
        
        function init() {
            // Set Chart.js defaults - WCAG AA compliant
            Chart.defaults.color = '#A0A0A0';
            Chart.defaults.borderColor = '#2A2A2A';
            Chart.defaults.font.family = "'JetBrains Mono', monospace";
            Chart.defaults.font.size = 10;
            
            // Populate dynamic project info
            const projectName = projectInfo.name || 'Unknown Project';
            const langs = projectInfo.languages || ['unknown'];
            const pkgMgr = projectInfo.packageManager || 'unknown';
            $('project-info').textContent = `${projectName} — ${pkgMgr} • Dependency Analysis`;
            
            // Populate detected language badges
            const langBadges = $('detected-langs');
            if (langBadges) {
                langBadges.innerHTML = langs.map(lang => 
                    `<span class="lang-badge ${lang.toLowerCase()}">${lang}</span>`
                ).join('');
            }
            
            $('timestamp').textContent = timestamp || new Date().toISOString();
            
            renderWinners();
            renderComparison();
            renderToolsChart();
            renderDocsBenchmark();
            renderDependencies();
            renderSecurity();
            renderLicenses();
            renderNamespaces();
            renderCapabilities();
            
            // Init raw outputs
            showOutput('ts', 'analyze_dependencies');
            showOutput('go', 'analyze_dependencies');
            showOutput('rust', 'analyze_dependencies');
            
            // HTMX - smooth scroll for nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', e => {
                    e.preventDefault();
                    const target = document.querySelector(item.getAttribute('href'));
                    if (target) target.scrollIntoView({ behavior: 'smooth' });
                    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                    item.classList.add('active');
                });
            });
        }
        
        // ══════════════════════════════════════════════════════════════════
        // Smoke Tests - Test MCP servers with history tracking
        // ══════════════════════════════════════════════════════════════════
        
        // Test history storage
        const TEST_HISTORY_KEY = 'dpb-smoke-test-history';
        
        function getTestHistory() {
            try {
                const data = localStorage.getItem(TEST_HISTORY_KEY);
                return data ? JSON.parse(data) : { runs: [], implementations: {} };
            } catch (e) {
                return { runs: [], implementations: {} };
            }
        }
        
        function saveTestHistory(history) {
            try {
                // Keep only last 50 runs
                if (history.runs.length > 50) {
                    history.runs = history.runs.slice(-50);
                }
                localStorage.setItem(TEST_HISTORY_KEY, JSON.stringify(history));
            } catch (e) {
                console.warn('Could not save test history:', e);
            }
        }
        
        function clearTestHistory() {
            localStorage.removeItem(TEST_HISTORY_KEY);
            const historySection = document.getElementById('test-history-section');
            if (historySection) {
                historySection.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: var(--space-4);">No test history yet. Run smoke tests to start tracking.</div>';
            }
        }
        
        function calculateStability(history, implName) {
            const implData = history.implementations[implName];
            if (!implData || implData.durations.length < 2) return null;
            
            const durations = implData.durations;
            const avg = durations.reduce((a, b) => a + b, 0) / durations.length;
            const variance = durations.reduce((sum, d) => sum + Math.pow(d - avg, 2), 0) / durations.length;
            const stdDev = Math.sqrt(variance);
            const coeffVar = (stdDev / avg) * 100; // Coefficient of variation %
            
            // Lower CV = more stable
            // <10% = excellent, 10-25% = good, >25% = poor
            return {
                avg: Math.round(avg),
                min: Math.min(...durations),
                max: Math.max(...durations),
                stdDev: Math.round(stdDev),
                coeffVar: Math.round(coeffVar),
                rating: coeffVar < 10 ? 'excellent' : coeffVar < 25 ? 'good' : 'poor',
                samples: durations.length
            };
        }
        
        function renderTestHistory(history) {
            const section = document.getElementById('test-history-section');
            if (!section) return;
            
            if (history.runs.length === 0) {
                section.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: var(--space-4);">No test history yet. Run smoke tests to start tracking.</div>';
                return;
            }
            
            // Calculate stats per implementation
            const implStats = {};
            ['TypeScript', 'Go', 'Rust'].forEach(impl => {
                implStats[impl] = calculateStability(history, impl);
            });
            
            section.innerHTML = `
                <div class="test-history-header">
                    <span class="test-history-title">Test History (${history.runs.length} runs)</span>
                    <button class="test-history-clear" onclick="Dashboard.clearTestHistory()">Clear History</button>
                </div>
                
                <div class="test-history-stats">
                    ${['TypeScript', 'Go', 'Rust'].map(impl => {
                        const stats = implStats[impl];
                        if (!stats) return `
                            <div class="test-history-stat">
                                <div class="test-history-stat-label">${impl}</div>
                                <div class="test-history-stat-value">--</div>
                            </div>
                        `;
                        return `
                            <div class="test-history-stat">
                                <div class="test-history-stat-label">${impl} (${stats.samples} runs)</div>
                                <div class="test-history-stat-value avg">${stats.avg}ms avg</div>
                                <div style="font-size: 9px; color: var(--text-secondary); margin-top: 4px;">
                                    min: <span class="test-history-stat-value best" style="font-size: 10px;">${stats.min}ms</span> • 
                                    max: <span class="test-history-stat-value worst" style="font-size: 10px;">${stats.max}ms</span>
                                </div>
                                <div class="stability-indicator">
                                    <span>Stability:</span>
                                    <div class="stability-bar">
                                        <div class="stability-fill ${stats.rating}" style="width: ${100 - Math.min(stats.coeffVar, 100)}%"></div>
                                    </div>
                                    <span style="color: var(--${stats.rating === 'excellent' ? 'success' : stats.rating === 'good' ? 'te-orange' : 'error'});">
                                        ${stats.rating} (±${stats.coeffVar}%)
                                    </span>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                
                <div class="test-history-runs">
                    ${history.runs.slice().reverse().map(run => `
                        <div class="test-history-run">
                            <span class="test-history-run-time">${new Date(run.timestamp).toLocaleString()}</span>
                            <div class="test-history-run-result">
                                <span class="test-history-run-pass">✓ ${run.passed}</span>
                                <span class="test-history-run-fail">✗ ${run.failed}</span>
                                <span class="test-history-run-duration">${run.duration}ms</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function runSmokeTests() {
            const btn = document.getElementById('run-smoke-test');
            const btnText = btn.querySelector('.btn-text');
            const btnIcon = btn.querySelector('.btn-icon');
            
            // Show modal
            let modal = document.getElementById('test-modal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'test-modal';
                modal.className = 'test-modal';
                modal.innerHTML = `
                    <div class="test-modal-content">
                        <div class="test-modal-header">
                            <div>
                                <div class="test-modal-title">Smoke Test Results</div>
                                <div id="test-timestamp" style="font-size: 10px; color: var(--text-secondary); margin-top: 4px;"></div>
                            </div>
                            <button class="test-modal-close" onclick="Dashboard.closeTestModal()">×</button>
                        </div>
                        <div id="test-results"></div>
                        <div class="test-history" id="test-history-section"></div>
                    </div>
                `;
                document.body.appendChild(modal);
            }
            
            // Update timestamp for current run
            const testTimestamp = document.getElementById('test-timestamp');
            if (testTimestamp) {
                testTimestamp.textContent = `Started: ${new Date().toLocaleString()}`;
            }
            
            // Load and render existing history
            const history = getTestHistory();
            renderTestHistory(history);
            
            const resultsContainer = document.getElementById('test-results');
            resultsContainer.innerHTML = '';
            
            // Update button state
            btn.classList.remove('success', 'error');
            btn.classList.add('running');
            btn.disabled = true;
            btnText.textContent = 'Running...';
            btnIcon.textContent = '◌';
            
            // Show modal
            setTimeout(() => modal.classList.add('visible'), 10);
            
            // All 14 MCP tools to test
            const tools = [
                { name: 'analyze_dependencies', desc: 'Dependency analysis', benchmarked: true },
                { name: 'analyze_psr4', desc: 'PSR-4 autoloading', benchmarked: true },
                { name: 'detect_namespaces', desc: 'Namespace detection', benchmarked: true },
                { name: 'analyze_namespace_usage', desc: 'Namespace usage', benchmarked: false },
                { name: 'generate_dependency_graph', desc: 'Dependency graph', benchmarked: false },
                { name: 'audit_security', desc: 'Security audit', benchmarked: true },
                { name: 'analyze_licenses', desc: 'License analysis', benchmarked: true },
                { name: 'find_circular_dependencies', desc: 'Circular deps', benchmarked: false },
                { name: 'analyze_multi_repo', desc: 'Multi-repo analysis', benchmarked: false },
                { name: 'generate_comprehensive_docs', desc: 'Documentation', benchmarked: false },
                { name: 'generate_mkdocs_docs', desc: 'MkDocs Generation', benchmarked: true },
                { name: 'track_dependencies', desc: 'Dependency tracking', benchmarked: false },
                { name: 'get_dependency_history', desc: 'Dependency history', benchmarked: false },
                { name: 'check_compliance', desc: 'Compliance check', benchmarked: false },
                { name: 'get_agent_suggestions', desc: 'Agent suggestions', benchmarked: false }
            ];
            
            const implementations = [
                { name: 'TypeScript', color: '#3178C6' },
                { name: 'Go', color: '#00ADD8' },
                { name: 'Rust', color: '#DEA584' }
            ];
            
            // Add overall progress - all 42 tools (14 tools × 3 implementations)
            const totalAllTests = implementations.length * tools.length;
            const overallProgress = document.createElement('div');
            overallProgress.className = 'overall-progress';
            overallProgress.innerHTML = `
                <div class="overall-progress-header">
                    <span>Testing <span id="current-test">0</span> of <span id="total-tests">${totalAllTests}</span> tools</span>
                    <span id="progress-percent">0%</span>
                </div>
                <div class="overall-progress-bar">
                    <div class="overall-progress-fill" id="overall-fill"></div>
                </div>
                <div style="font-size: 10px; color: var(--text-secondary); margin-top: var(--space-2);">
                    14 tools × 3 implementations = 42 total tests
                </div>
            `;
            resultsContainer.appendChild(overallProgress);
            
            let passCount = 0;
            let failCount = 0;
            let testCount = 0;
            const totalTests = totalAllTests;
            
            // Create sections for each implementation
            implementations.forEach((impl) => {
                const implSection = document.createElement('div');
                implSection.style.marginBottom = 'var(--space-5)';
                implSection.id = `test-impl-${impl.name.toLowerCase()}`;
                
                const implData = benchmarkResults && benchmarkResults[impl.name];
                const hasData = !!implData;
                
                implSection.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-3);">
                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 12px; color: ${impl.color};">
                            ${impl.name} Implementation
                        </div>
                        <div style="font-size: 10px; color: var(--text-secondary);">
                            ${hasData ? `${implData.size_mb || '?'}MB • ${implData.startup_ms || '?'}ms startup • ${implData.memory_mb || '?'}MB RAM` : 'No data'}
                        </div>
                    </div>
                    <div class="impl-tools" id="tools-${impl.name.toLowerCase()}"></div>
                `;
                resultsContainer.appendChild(implSection);
            });
            
            // Add summary section
            const summarySection = document.createElement('div');
            summarySection.className = 'test-summary';
            summarySection.innerHTML = `
                <div class="test-summary-stats">
                    <div class="test-summary-stat">
                        <div class="test-summary-value pass" id="pass-count">0</div>
                        <div class="test-summary-label">Passed</div>
                    </div>
                    <div class="test-summary-stat">
                        <div class="test-summary-value fail" id="fail-count">0</div>
                        <div class="test-summary-label">Failed</div>
                    </div>
                    <div class="test-summary-stat">
                        <div class="test-summary-value" id="total-time">0ms</div>
                        <div class="test-summary-label">Total Time</div>
                    </div>
                </div>
            `;
            resultsContainer.appendChild(summarySection);
            
            const startTime = Date.now();
            
            // Run tests for each implementation and tool
            implementations.forEach((impl, implIdx) => {
                const toolsContainer = document.getElementById(`tools-${impl.name.toLowerCase()}`);
                const implData = benchmarkResults && benchmarkResults[impl.name];
                
                tools.forEach((tool, toolIdx) => {
                    const testItem = document.createElement('div');
                    testItem.className = 'test-result-item pending';
                    testItem.innerHTML = `
                        <div class="test-result-header">
                            <span class="test-result-name">${tool.name}</span>
                            <span class="test-result-status pending">...</span>
                        </div>
                        <div class="test-result-details">${tool.desc}</div>
                        <div class="test-progress-bar">
                            <div class="test-progress-fill" id="progress-${impl.name}-${toolIdx}"></div>
                        </div>
                    `;
                    toolsContainer.appendChild(testItem);
                    
                    // Simulate test execution with progress
                    const delay = (implIdx * tools.length + toolIdx) * 80;
                    const progressFill = testItem.querySelector('.test-progress-fill');
                    
                    // Start progress animation
                    setTimeout(() => {
                        progressFill.style.width = '30%';
                    }, delay);
                    
                    setTimeout(() => {
                        progressFill.style.width = '70%';
                    }, delay + 40);
                    
                    // Complete test
                    setTimeout(() => {
                        const hasToolData = implData && implData[tool.name] !== undefined;
                        const execTime = hasToolData ? implData[tool.name] : null;
                        const isBenchmarked = tool.benchmarked;
                        
                        // Pass if: has benchmark data OR is not a benchmarked tool (registered)
                        const passed = hasToolData || !isBenchmarked;
                        
                        progressFill.style.width = '100%';
                        progressFill.classList.add(passed ? 'complete' : 'failed');
                        
                        testItem.className = `test-result-item ${passed ? 'pass' : 'fail'}`;
                        testItem.querySelector('.test-result-status').className = `test-result-status ${passed ? 'pass' : 'fail'}`;
                        
                        if (hasToolData) {
                            // Has benchmark data - show timing
                            testItem.innerHTML = `
                                <div class="test-result-header">
                                    <span class="test-result-name">${tool.name}</span>
                                    <span class="test-result-status pass">${execTime}ms</span>
                                </div>
                                <div class="test-metrics">
                                    <div class="test-metric">
                                        <span>exec:</span>
                                        <span class="test-metric-value">${execTime}ms</span>
                                    </div>
                                    <div class="test-metric">
                                        <span>status:</span>
                                        <span class="test-metric-value" style="color: var(--success);">✓ benchmarked</span>
                                    </div>
                                </div>
                            `;
                            passCount++;
                        } else if (!isBenchmarked) {
                            // Not benchmarked but registered - show as registered
                            testItem.innerHTML = `
                                <div class="test-result-header">
                                    <span class="test-result-name">${tool.name}</span>
                                    <span class="test-result-status pass" style="background: rgba(59, 130, 246, 0.2); color: var(--info);">registered</span>
                                </div>
                                <div class="test-metrics">
                                    <div class="test-metric">
                                        <span>status:</span>
                                        <span class="test-metric-value" style="color: var(--info);">✓ available</span>
                                    </div>
                                </div>
                            `;
                            passCount++;
                        } else {
                            // Benchmarked but no data - fail
                            testItem.querySelector('.test-result-status').textContent = 'N/A';
                            failCount++;
                        }
                        
                        testCount++;
                        
                        // Update overall progress
                        const percent = Math.round((testCount / totalTests) * 100);
                        document.getElementById('current-test').textContent = testCount;
                        document.getElementById('progress-percent').textContent = `${percent}%`;
                        document.getElementById('overall-fill').style.width = `${percent}%`;
                        document.getElementById('pass-count').textContent = passCount;
                        document.getElementById('fail-count').textContent = failCount;
                        document.getElementById('total-time').textContent = `${Date.now() - startTime}ms`;
                        
                        // All tests complete
                        if (testCount === totalTests) {
                            const totalDuration = Date.now() - startTime;
                            const allPassed = failCount === 0;
                            
                            // Record to history
                            const history = getTestHistory();
                            const runRecord = {
                                timestamp: new Date().toISOString(),
                                passed: passCount,
                                failed: failCount,
                                duration: totalDuration,
                                implementations: {}
                            };
                            
                            // Calculate per-implementation total execution time
                            implementations.forEach(impl => {
                                const implData = benchmarkResults && benchmarkResults[impl.name];
                                if (implData) {
                                    const toolTimes = tools
                                        .filter(t => t.benchmarked && implData[t.name])
                                        .map(t => implData[t.name]);
                                    const totalTime = toolTimes.reduce((a, b) => a + b, 0);
                                    
                                    runRecord.implementations[impl.name] = totalTime;
                                    
                                    // Track implementation stats
                                    if (!history.implementations[impl.name]) {
                                        history.implementations[impl.name] = { durations: [] };
                                    }
                                    history.implementations[impl.name].durations.push(totalTime);
                                    
                                    // Keep only last 20 durations per implementation
                                    if (history.implementations[impl.name].durations.length > 20) {
                                        history.implementations[impl.name].durations = 
                                            history.implementations[impl.name].durations.slice(-20);
                                    }
                                }
                            });
                            
                            history.runs.push(runRecord);
                            saveTestHistory(history);
                            renderTestHistory(history);
                            
                            btn.classList.remove('running');
                            btn.classList.add(allPassed ? 'success' : 'error');
                            btn.disabled = false;
                            btnText.textContent = allPassed ? `${passCount}/${totalTests} Passed` : `${failCount} Failed`;
                            btnIcon.textContent = allPassed ? '✓' : '✗';
                            
                            // Reset button after 5 seconds
                            setTimeout(() => {
                                btn.classList.remove('success', 'error');
                                btnText.textContent = 'Run Smoke Tests';
                                btnIcon.textContent = '▶';
                            }, 5000);
                        }
                    }, delay + 80);
                });
            });
        }
        
        function closeTestModal() {
            const modal = document.getElementById('test-modal');
            if (modal) {
                modal.classList.remove('visible');
            }
        }
        
        // Public API
        function showDocsModal() {
            let modal = document.getElementById('docs-modal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'docs-modal';
                modal.className = 'test-modal';
                modal.innerHTML = `
                    <div class="test-modal-content" style="max-width: 800px;">
                        <div class="test-modal-header">
                            <div>
                                <div class="test-modal-title">Documentation Generation Guide</div>
                            </div>
                            <button class="test-modal-close" onclick="Dashboard.closeDocsModal()">×</button>
                        </div>
                        <div style="padding: var(--space-5); line-height: 1.6;">
                            <h3 style="margin-bottom: var(--space-4); color: var(--text-primary);">Quick Start</h3>
                            <pre style="background: var(--bg-tertiary); padding: var(--space-4); border-radius: 4px; overflow-x: auto; margin-bottom: var(--space-4);"><code># Generate docs (via Cursor IDE or CLI)
@dependency-buster generate_mkdocs_docs repo_path=/path/to/repo format=html

# Or via command line (TypeScript)
echo '{"jsonrpc":"2.0","method":"tools/call","params":{"name":"generate_mkdocs_docs","arguments":{"repo_path":"/path/to/repo","format":"html"}},"id":1}' | node dpb-mcp-typescript/build/server.js

# Or via command line (Go)
echo '{"jsonrpc":"2.0","method":"tools/call","params":{"name":"generate_mkdocs_docs","arguments":{"repo_path":"/path/to/repo","format":"html"}},"id":1}' | ./dpb-mcp-go/build/dpb-mcp

# Or via command line (Rust)
echo '{"jsonrpc":"2.0","method":"tools/call","params":{"name":"generate_mkdocs_docs","arguments":{"repo_path":"/path/to/repo","format":"html"}},"id":1}' | ./dpb-mcp-rust/target/release/dpb-mcp</code></pre>
                            
                            <h3 style="margin-bottom: var(--space-4); margin-top: var(--space-6); color: var(--text-primary);">Viewing Generated Documentation</h3>
                            
                            <div style="margin-bottom: var(--space-4);">
                                <strong style="color: var(--te-orange);">Option 1: HTML Files (Recommended - No Python Required)</strong>
                                <pre style="background: var(--bg-tertiary); padding: var(--space-4); border-radius: 4px; overflow-x: auto; margin-top: var(--space-2);"><code># Open HTML files directly in browser
open docs-typescript/index.html
open docs-go/index.html
open docs-rust/index.html

# Or use the "View Documentation" menu item in the dashboard</code></pre>
                            </div>
                            
                            <div style="margin-bottom: var(--space-4);">
                                <strong style="color: var(--te-orange);">Option 2: View Markdown Files</strong>
                                <pre style="background: var(--bg-tertiary); padding: var(--space-4); border-radius: 4px; overflow-x: auto; margin-top: var(--space-2);"><code># Markdown files are generated alongside HTML for AI agents
code docs-typescript/index.md
code docs-go/index.md
code docs-rust/index.md</code></pre>
                            </div>
                            
                            <div style="margin-top: var(--space-6); padding: var(--space-4); background: var(--bg-tertiary); border-radius: 4px; border-left: 3px solid var(--info);">
                                <strong style="color: var(--info);">💡 Auto-Generation</strong>
                                <p style="margin-top: var(--space-2); margin-bottom: 0; color: var(--text-secondary);">
                                    Documentation is automatically generated when the dashboard server starts for the first time (if docs don't exist). 
                                    All three implementations (TypeScript, Go, Rust) generate docs in separate folders: docs-typescript/, docs-go/, docs-rust/
                                </p>
                            </div>
                            
                            <div style="margin-top: var(--space-4); padding: var(--space-4); background: var(--bg-tertiary); border-radius: 4px; border-left: 3px solid var(--success);">
                                <strong style="color: var(--success);">✓ No Python Required</strong>
                                <p style="margin-top: var(--space-2); margin-bottom: 0; color: var(--text-secondary);">
                                    Documentation generation uses native HTML generation. No mkdocs, pip, or Python dependencies needed.
                                </p>
                            </div>
                            
                            <div style="margin-top: var(--space-4); padding: var(--space-4); background: var(--bg-tertiary); border-radius: 4px; border-left: 3px solid var(--warning);">
                                <strong style="color: var(--warning);">⚠️ Note</strong>
                                <p style="margin-top: var(--space-2); margin-bottom: 0; color: var(--text-secondary);">
                                    Documentation does NOT regenerate automatically on code changes. You need to call the tool manually or set up CI/CD.
                                </p>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }
            setTimeout(() => modal.classList.add('visible'), 10);
        }
        
        function closeDocsModal() {
            const modal = document.getElementById('docs-modal');
            if (modal) {
                modal.classList.remove('visible');
            }
        }
        
        function openDocumentation() {
            // Check which documentation implementations are available
            const docsOptions = [
                { name: 'TypeScript', path: '/docs-typescript/index.html', altPaths: ['../docs-typescript/index.html', '../../docs-typescript/index.html', 'docs-typescript/index.html'] },
                { name: 'Go', path: '/docs-go/index.html', altPaths: ['../docs-go/index.html', '../../docs-go/index.html', 'docs-go/index.html'] },
                { name: 'Rust', path: '/docs-rust/index.html', altPaths: ['../docs-rust/index.html', '../../docs-rust/index.html', 'docs-rust/index.html'] },
                { name: 'Generic', path: '/docs/index.html', altPaths: ['../docs/index.html', '../../docs/index.html', 'docs/index.html'] }
            ];
            
            // Check availability of each implementation
            const availableDocs = [];
            let totalChecked = 0;
            const totalPathsToCheck = docsOptions.reduce((sum, opt) => sum + 1 + opt.altPaths.length, 0);
            
            docsOptions.forEach(option => {
                const allPaths = [option.path, ...option.altPaths];
                let optionFound = false;
                
                allPaths.forEach(path => {
                    fetch(path, { method: 'HEAD', cache: 'no-cache' })
                        .then(response => {
                            totalChecked++;
                            if (response.ok && !optionFound) {
                                optionFound = true;
                                availableDocs.push({ name: option.name, path: path });
                            }
                            if (totalChecked === totalPathsToCheck) {
                                showDocsSelection(availableDocs);
                            }
                        })
                        .catch(() => {
                            totalChecked++;
                            if (totalChecked === totalPathsToCheck) {
                                showDocsSelection(availableDocs);
                            }
                        });
                });
            });
            
            // Fallback timeout - show results after 1.5 seconds even if not all checked
            setTimeout(() => {
                if (availableDocs.length > 0 || totalChecked >= totalPathsToCheck) {
                    showDocsSelection(availableDocs);
                } else {
                    // Still checking, wait a bit more
                    setTimeout(() => showDocsSelection(availableDocs), 1000);
                }
            }, 1500);
        }
        
        function showDocsSelection(availableDocs) {
            if (availableDocs.length === 0) {
                alert('No documentation found. Please generate docs first using:\n\n@dependency-buster generate_mkdocs_docs repo_path=/path/to/repo format=html\n\nOr use the "View Docs Guide" for instructions.');
                return;
            }
            
            if (availableDocs.length === 1) {
                // Only one option, open it directly
                window.open(availableDocs[0].path, '_blank');
                return;
            }
            
            // Multiple options - show selection modal
            let modal = document.getElementById('docs-selection-modal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'docs-selection-modal';
                modal.className = 'test-modal';
                document.body.appendChild(modal);
            }
            
            modal.innerHTML = `
                <div class="test-modal-content" style="max-width: 500px;">
                    <div class="test-modal-header">
                        <div>
                            <div class="test-modal-title">Select Documentation</div>
                        </div>
                        <button class="test-modal-close" onclick="Dashboard.closeDocsSelectionModal()">×</button>
                    </div>
                    <div style="padding: var(--space-5);">
                        <p style="margin-bottom: var(--space-4); color: var(--text-secondary);">
                            Multiple documentation implementations are available. Choose which one to view:
                        </p>
                        <div style="display: flex; flex-direction: column; gap: var(--space-3);">
                            ${availableDocs.map(doc => `
                                <button onclick="Dashboard.openDoc('${doc.path}')" style="
                                    padding: var(--space-4);
                                    background: var(--bg-tertiary);
                                    border: 1px solid var(--border);
                                    border-radius: 4px;
                                    cursor: pointer;
                                    text-align: left;
                                    transition: all 0.15s ease;
                                    color: var(--text-primary);
                                " onmouseover="this.style.background='var(--bg-secondary)'" onmouseout="this.style.background='var(--bg-tertiary)'">
                                    <strong style="color: var(--te-orange);">${doc.name}</strong>
                                    <div style="font-size: 12px; color: var(--text-secondary); margin-top: var(--space-1);">${doc.path}</div>
                                </button>
                            `).join('')}
                        </div>
                        <div style="margin-top: var(--space-4); padding: var(--space-3); background: var(--bg-tertiary); border-radius: 4px; border-left: 3px solid var(--info);">
                            <div style="font-size: 12px; color: var(--text-secondary);">
                                <strong style="color: var(--info);">💡 Tip:</strong> Each implementation generates docs independently. You can compare them side-by-side.
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Ensure modal is visible (remove any existing visible class first, then add it)
            modal.classList.remove('visible');
            setTimeout(() => modal.classList.add('visible'), 10);
        }
        
        function openDoc(path) {
            window.open(path, '_blank');
            closeDocsSelectionModal();
        }
        
        function closeDocsSelectionModal() {
            const modal = document.getElementById('docs-selection-modal');
            if (modal) {
                modal.classList.remove('visible');
            }
        }
        
        return { init, showTab, showOutput, runSmokeTests, closeTestModal, clearTestHistory, showDocsModal, closeDocsModal, openDocumentation, openDoc, showDocsSelection, closeDocsSelectionModal };
    })();
    
    // Run on DOM ready
    document.addEventListener('DOMContentLoaded', Dashboard.init);
    </script>
</body>
</html>
